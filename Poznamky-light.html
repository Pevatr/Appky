<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Pozn√°mky ‚Äì rychl√Ω z√°znam</title>
<meta name="theme-color" content="#0f172a" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<style>
:root {
  --bg:      #0f172a;
  --surface: #0b1220;
  --surface2:#111827;
  --border:  rgba(255,255,255,.09);
  --text:    #e5e7eb;
  --muted:   #64748b;
  --accent:  #22c55e;
  --accent2: #16a34a;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
html, body {
  height: 100%; background: var(--bg); color: var(--text);
  font-family: ui-rounded, system-ui, -apple-system, sans-serif;
  overscroll-behavior: none;
}
.app {
  max-width: 430px; margin: 0 auto;
  min-height: 100dvh; display: flex; flex-direction: column;
  padding-bottom: env(safe-area-inset-bottom);
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.hdr {
  padding: 16px 16px 10px;
  padding-top: calc(14px + env(safe-area-inset-top));
  display: flex; align-items: center; justify-content: space-between;
}
.hdr-title {
  font-size: .72rem; font-weight: 700; letter-spacing: .12em;
  text-transform: uppercase; color: var(--muted);
}
.hbtn {
  height: 34px; padding: 0 12px;
  border-radius: 9px; border: 1px solid var(--border);
  background: var(--surface); color: var(--muted);
  font-size: .78rem; font-weight: 600; cursor: pointer;
  display: flex; align-items: center; gap: 4px;
  transition: background .1s, color .1s;
  white-space: nowrap;
}
.hbtn:active { background: #1e2a3d; }
.hbtn.active { color: var(--accent); border-color: rgba(34,197,94,.35); }

/* ‚îÄ‚îÄ COUNTER ‚îÄ‚îÄ */
.counter {
  padding: 2px 16px 10px;
  font-size: .78rem; color: var(--muted);
}
.counter span { color: var(--text); font-weight: 700; }

/* ‚îÄ‚îÄ QUICK INPUT ‚îÄ‚îÄ */
.quick-block {
  margin: 0 12px 12px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 12px 12px 12px;
  display: flex; flex-direction: column; gap: 8px;
  transition: border-color .15s;
}
.quick-block:focus-within { border-color: rgba(34,197,94,.35); }

.quick-top {
  display: flex; gap: 8px; align-items: flex-start;
}
.quick-title {
  flex: 1; height: 42px;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 10px; color: var(--text);
  font-size: .95rem; font-weight: 600;
  padding: 0 12px; outline: none;
  transition: border-color .15s;
}
.quick-title:focus { border-color: rgba(34,197,94,.3); }
.quick-title::placeholder { color: var(--muted); font-weight: 400; }

.quick-send {
  height: 42px; width: 42px; flex-shrink: 0;
  border-radius: 10px; border: none;
  background: linear-gradient(160deg, var(--accent), var(--accent2));
  color: #052e16; font-size: 1.1rem; font-weight: 800;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: opacity .12s, transform .06s;
}
.quick-send:active { transform: scale(.92); opacity: .8; }
.quick-send:disabled { opacity: .35; cursor: not-allowed; }

.quick-body {
  width: 100%; min-height: 70px;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 10px; color: var(--text);
  font-size: .88rem; padding: 10px 12px; outline: none;
  resize: none; font-family: inherit;
  transition: border-color .15s;
}
.quick-body:focus { border-color: rgba(34,197,94,.25); }
.quick-body::placeholder { color: var(--muted); }

/* ‚îÄ‚îÄ KATEGORIE GRID ‚îÄ‚îÄ */
.cats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 7px;
}
.cat-btn {
  height: 52px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--surface2);
  color: var(--text);
  font-size: .65rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
  transition: background .1s, border-color .1s, transform .06s;
  line-height: 1.2;
}
.cat-btn .ico { font-size: 1.2rem; line-height: 1; }
.cat-btn:active { transform: scale(.93); }
.cat-btn.sel {
  background: rgba(34,197,94,.13);
  border-color: rgba(34,197,94,.5);
  color: #a7f3d0;
}

/* ‚îÄ‚îÄ SEZNAM ‚îÄ‚îÄ */
.notes-list {
  flex: 1; overflow-y: auto;
  padding: 0 12px 16px;
  display: flex; flex-direction: column; gap: 7px;
}

.note-card {
  display: flex;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  animation: slideIn .16s ease;
}
@keyframes slideIn {
  from { opacity: 0; transform: translateY(-5px); }
  to   { opacity: 1; transform: translateY(0); }
}
.note-bar { width: 4px; flex-shrink: 0; }
.note-body {
  flex: 1; padding: 10px 10px; min-width: 0;
  cursor: pointer;
}
.note-head {
  display: flex; align-items: baseline; gap: 6px; margin-bottom: 2px;
}
.note-icon { font-size: .9rem; flex-shrink: 0; }
.note-title {
  font-size: .9rem; font-weight: 700;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  flex: 1;
}
.note-preview {
  font-size: .78rem; color: #9ca3af;
  display: -webkit-box; -webkit-line-clamp: 2;
  -webkit-box-orient: vertical; overflow: hidden;
  line-height: 1.45;
}
.note-meta { font-size: .68rem; color: var(--muted); margin-top: 4px; }
.note-actions {
  display: flex; flex-direction: column;
  justify-content: center; gap: 4px;
  padding: 8px 8px 8px 4px; flex-shrink: 0;
}
.nact {
  width: 28px; height: 28px; border-radius: 7px;
  border: 1px solid var(--border); background: transparent;
  color: var(--muted); font-size: .85rem; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: background .1s, color .1s;
}
.nact:active { background: rgba(255,255,255,.07); color: var(--text); }
.nact.pin-on  { color: #fbbf24; border-color: rgba(251,191,36,.3); }
.nact.done-btn { color: #22c55e; border-color: rgba(34,197,94,.3); }

/* ‚îÄ‚îÄ CONFIRM DIALOG ‚îÄ‚îÄ */
.confirm-backdrop {
  position: fixed; inset: 0; background: rgba(0,0,0,.6);
  display: none; align-items: center; justify-content: center;
  z-index: 200; padding: 20px;
}
.confirm-backdrop.open { display: flex; animation: fadeIn .15s ease; }
.confirm-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 24px 20px 20px;
  width: 100%; max-width: 300px;
  display: flex; flex-direction: column; gap: 16px;
  text-align: center;
}
.confirm-box h3 { font-size: 1rem; font-weight: 700; color: var(--text); }
.confirm-box p  { font-size: .85rem; color: var(--muted); line-height: 1.5; }
.confirm-btns   { display: flex; gap: 8px; }
.confirm-btns button {
  flex: 1; height: 42px; border-radius: 10px; font-size: .9rem;
  font-weight: 700; cursor: pointer; border: 1px solid var(--border);
  transition: background .1s, transform .06s;
}
.confirm-btns button:active { transform: scale(.96); }
.confirm-no  { background: var(--surface2); color: var(--text); }
.confirm-yes { background: rgba(239,68,68,.15); color: #fca5a5; border-color: rgba(239,68,68,.3); }

.empty {
  text-align: center; color: var(--muted);
  font-size: .85rem; padding: 40px 0;
}

/* ‚îÄ‚îÄ EDIT SHEET ‚îÄ‚îÄ */
.sheet-backdrop {
  position: fixed; inset: 0; background: rgba(0,0,0,.55);
  display: none; align-items: flex-end; justify-content: center; z-index: 80;
}
.sheet-backdrop.open { display: flex; animation: fadeIn .15s ease; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.sheet {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 18px 18px 0 0;
  width: 100%; max-width: 430px;
  padding: 20px 16px calc(20px + env(safe-area-inset-bottom));
  max-height: 92dvh; display: flex; flex-direction: column; gap: 10px;
  overflow-y: auto;
}
.sheet-handle {
  width: 36px; height: 4px; border-radius: 2px;
  background: rgba(255,255,255,.15); margin: -8px auto 4px;
  flex-shrink: 0;
}
.sheet h2 { font-size: .95rem; font-weight: 700; }
.sheet label { font-size: .75rem; color: var(--muted); margin-bottom: 3px; display: block; }
.sheet input, .sheet textarea {
  width: 100%; padding: 10px 12px; border-radius: 10px;
  border: 1px solid var(--border); background: var(--surface2);
  color: var(--text); font-size: .9rem; font-family: inherit; outline: none;
  transition: border-color .15s;
}
.sheet input:focus, .sheet textarea:focus { border-color: rgba(34,197,94,.3); }
.sheet textarea { min-height: 100px; resize: none; }
.sheet-actions {
  display: flex; gap: 7px; flex-wrap: wrap; margin-top: 4px;
}
.sbtn {
  height: 40px; padding: 0 14px; border-radius: 9px;
  border: 1px solid var(--border); background: var(--surface2);
  color: var(--text); font-size: .85rem; font-weight: 600; cursor: pointer;
  transition: background .1s;
}
.sbtn:active { background: #1e2a3d; }
.sbtn.primary {
  background: linear-gradient(160deg, var(--accent), var(--accent2));
  border: none; color: #052e16;
}
.sbtn.danger { color: #fca5a5; border-color: rgba(239,68,68,.25); }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position: fixed; left: 50%;
  bottom: calc(18px + env(safe-area-inset-bottom));
  transform: translateX(-50%) translateY(10px);
  background: var(--surface2); border: 1px solid rgba(255,255,255,.12);
  border-radius: 999px; padding: 9px 16px;
  display: flex; gap: 10px; align-items: center;
  font-size: .85rem; color: var(--text); white-space: nowrap;
  z-index: 99; opacity: 0; pointer-events: none;
  transition: opacity .16s, transform .16s;
  box-shadow: 0 8px 24px rgba(0,0,0,.4);
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
.toast-undo { color: var(--accent); text-decoration: underline; cursor: pointer; font-weight: 700; }
</style>
</head>
<body>
<div class="app">

  <!-- HEADER -->
  <div class="hdr">
    <div class="hdr-title">üìù Pozn√°mky</div>
    <button class="hbtn" id="btnArchive">üì¶ Archiv</button>
  </div>

  <!-- POƒåET -->
  <div class="counter" id="counter"></div>

  <!-- RYCHL√ù Z√ÅPIS -->
  <div class="quick-block">
    <div class="quick-top">
      <input class="quick-title" id="qTitle" type="text"
             placeholder="Rychl√° pozn√°mka‚Ä¶" autocomplete="off" />
      <button class="quick-send" id="btnSend" disabled>‚Üë</button>
    </div>
    <textarea class="quick-body" id="qBody" placeholder="Text (volitelnƒõ)‚Ä¶" rows="3"></textarea>
    <div class="cats-grid" id="catGrid"></div>
  </div>

  <!-- SEZNAM -->
  <div class="notes-list" id="notesList"></div>

</div>

<!-- CONFIRM DIALOG -->
<div class="confirm-backdrop" id="confirmBackdrop">
  <div class="confirm-box">
    <h3>Smazat pozn√°mku?</h3>
    <p id="confirmMsg">Tato akce je nevratn√°.</p>
    <div class="confirm-btns">
      <button class="confirm-no"  id="confirmNo">Ne</button>
      <button class="confirm-yes" id="confirmYes">Ano, smazat</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <span id="toastMsg"></span>
</div>

<!-- EDIT SHEET -->
<div class="sheet-backdrop" id="editBackdrop">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <h2 id="editHeading">Upravit pozn√°mku</h2>
    <div>
      <label>Titulek</label>
      <input id="eTitle" type="text" />
    </div>
    <div>
      <label>Text (volitelnƒõ)</label>
      <textarea id="eBody" rows="4"></textarea>
    </div>
    <div>
      <label>Kategorie</label>
      <div class="cats-grid" id="eCats" style="margin-top:4px;"></div>
    </div>
    <div class="sheet-actions">
      <button class="sbtn primary" id="editSave">Ulo≈æit</button>
      <button class="sbtn" id="editPin">P≈ôipnout</button>
      <button class="sbtn" id="editArchiveBtn">Archivovat</button>
      <button class="sbtn danger" id="editDelete">Smazat</button>
      <button class="sbtn" id="editCancel">Zru≈°it</button>
    </div>
  </div>
</div>

<script>
const KEY = 'poznamky_light';

const CATS = [
  { id: 'private',   ico: 'üè†', label: 'Osobn√≠',    color: '#3b82f6' },
  { id: 'work',      ico: 'üíº', label: 'Pracovn√≠',  color: '#f97316' },
  { id: 'idea',      ico: 'üí°', label: 'N√°pad',     color: '#eab308' },
  { id: 'important', ico: 'üìå', label: 'D≈Øle≈æit√©',  color: '#ec4899' },
  { id: 'critical',  ico: '‚ö†Ô∏è', label: 'Kritick√©',  color: '#ef4444' },
  { id: 'learn',     ico: 'üìñ', label: 'Uƒçen√≠',     color: '#a855f7' },
  { id: 'health',    ico: 'üè•', label: 'Zdrav√≠',    color: '#22c55e' },
  { id: 'other',     ico: 'üì¶', label: 'Ostatn√≠',   color: '#64748b' },
];

function catInfo(id) { return CATS.find(c => c.id === id) || CATS[7]; }
function load() {
  try {
    const d = JSON.parse(localStorage.getItem(KEY) || '{"notes":[]}');
    return Array.isArray(d.notes) ? d : { notes: [] };
  } catch(_) { return { notes: [] }; }
}
function save(d) { localStorage.setItem(KEY, JSON.stringify(d)); }
function nowISO() { return new Date().toISOString(); }
function fmtDate(iso) {
  const d = new Date(iso);
  const today = new Date().toDateString();
  const yest  = new Date(Date.now()-86400000).toDateString();
  if (d.toDateString() === today) return 'Dnes ' + d.toLocaleTimeString('cs-CZ',{hour:'2-digit',minute:'2-digit'});
  if (d.toDateString() === yest)  return 'Vƒçera ' + d.toLocaleTimeString('cs-CZ',{hour:'2-digit',minute:'2-digit'});
  return d.toLocaleDateString('cs-CZ',{day:'numeric',month:'short'});
}
function esc(s) {
  return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let qCat       = null;
let editId     = null;
let eCat       = 'private';
let toastTimer = null;
let showArchive = false;

// ‚îÄ‚îÄ BUILD CAT GRID ‚îÄ‚îÄ
function buildCatGrid(containerId, selectedId, onSelect) {
  const grid = document.getElementById(containerId);
  grid.innerHTML = '';
  CATS.forEach(c => {
    const btn = document.createElement('button');
    btn.className = 'cat-btn' + (selectedId === c.id ? ' sel' : '');
    btn.innerHTML = `<span class="ico">${c.ico}</span><span>${c.label}</span>`;
    btn.onclick = () => onSelect(c.id);
    grid.appendChild(btn);
  });
}

function buildQGrid() {
  buildCatGrid('catGrid', qCat, id => {
    qCat = (qCat === id) ? null : id;
    buildQGrid();
    validateAdd();
  });
}

function buildEGrid() {
  buildCatGrid('eCats', eCat, id => {
    eCat = id;
    buildEGrid();
  });
}

function validateAdd() {
  const title = document.getElementById('qTitle').value.trim();
  document.getElementById('btnSend').disabled = !(title && qCat);
}

// ‚îÄ‚îÄ ADD ‚îÄ‚îÄ
function addNote() {
  const title = document.getElementById('qTitle').value.trim();
  if (!title || !qCat) return;
  const body = document.getElementById('qBody').value.trim();
  const d = load();
  d.notes.unshift({
    id: 'n_' + Date.now(),
    title, text: body,
    category: qCat,
    pinned: false, archived: false,
    created: nowISO(), updated: nowISO()
  });
  save(d);
  document.getElementById('qTitle').value = '';
  document.getElementById('qBody').value  = '';
  qCat = null;
  buildQGrid();
  validateAdd();
  render();
  document.getElementById('qTitle').focus();
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ
function getSorted(archived) {
  const d = load();
  let arr = d.notes.filter(n => !!n.archived === archived);
  arr.sort((a,b) => {
    if (a.pinned !== b.pinned) return a.pinned ? -1 : 1;
    return a.updated < b.updated ? 1 : -1;
  });
  return arr;
}

function renderList(arr, isArchive) {
  const list = document.getElementById('notesList');
  list.innerHTML = '';
  if (!arr.length) {
    list.innerHTML = `<div class="empty">${isArchive ? 'Archiv je pr√°zdn√Ω.' : '≈Ω√°dn√© pozn√°mky.'}</div>`;
    return;
  }
  arr.forEach(n => {
    const cat = catInfo(n.category);
    const card = document.createElement('div');
    card.className = 'note-card';

    const bar = document.createElement('div');
    bar.className = 'note-bar';
    bar.style.background = cat.color;

    const body = document.createElement('div');
    body.className = 'note-body';
    if (isArchive) body.style.opacity = '.7';
    body.onclick = () => openEdit(n.id);
    body.innerHTML = `
      <div class="note-head">
        <span class="note-icon">${cat.ico}</span>
        <span class="note-title">${esc(n.title)}</span>
      </div>
      ${n.text ? `<div class="note-preview">${esc(n.text)}</div>` : ''}
      <div class="note-meta">${fmtDate(n.updated)}</div>
    `;

    const acts = document.createElement('div');
    acts.className = 'note-actions';

    if (isArchive) {
      // Archiv: ‚Ü© Vr√°tit + üóë Smazat (s potvrzen√≠m)
      const restoreBtn = document.createElement('button');
      restoreBtn.className = 'nact';
      restoreBtn.textContent = '‚Ü©';
      restoreBtn.title = 'Vr√°tit na hlavn√≠ panel';
      restoreBtn.onclick = e => { e.stopPropagation(); restoreNote(n.id); };
      acts.appendChild(restoreBtn);

      const delBtn = document.createElement('button');
      delBtn.className = 'nact';
      delBtn.textContent = 'üóë';
      delBtn.title = 'Smazat';
      delBtn.onclick = e => { e.stopPropagation(); deleteNote(n.id); };
      acts.appendChild(delBtn);

    } else {
      // Hlavn√≠ panel: ‚òÜ Pin + ‚úì Hotovo + üóë Smazat
      const pinBtn = document.createElement('button');
      pinBtn.className = 'nact' + (n.pinned ? ' pin-on' : '');
      pinBtn.textContent = n.pinned ? '‚òÖ' : '‚òÜ';
      pinBtn.title = n.pinned ? 'Odepnout' : 'P≈ôipnout';
      pinBtn.onclick = e => { e.stopPropagation(); togglePin(n.id); };
      acts.appendChild(pinBtn);

      const doneBtn = document.createElement('button');
      doneBtn.className = 'nact done-btn';
      doneBtn.textContent = '‚úì';
      doneBtn.title = 'Hotovo ‚Äì p≈ôesunout do archivu';
      doneBtn.onclick = e => { e.stopPropagation(); archiveNote(n.id); };
      acts.appendChild(doneBtn);

      const delBtn = document.createElement('button');
      delBtn.className = 'nact';
      delBtn.textContent = 'üóë';
      delBtn.title = 'Smazat';
      delBtn.onclick = e => { e.stopPropagation(); deleteNote(n.id); };
      acts.appendChild(delBtn);
    }

    card.append(bar, body, acts);
    list.appendChild(card);
  });
}

function render() {
  const arr = getSorted(false);
  const all = load().notes.filter(n => !n.archived);
  document.getElementById('counter').innerHTML = `<span>${all.length}</span> pozn√°mek celkem`;
  document.getElementById('btnArchive').classList.remove('active');
  renderList(arr, false);
}

function renderArchive() {
  const arr = getSorted(true);
  document.getElementById('counter').innerHTML = `Archiv ‚Äì <span>${arr.length}</span> pozn√°mek`;
  document.getElementById('btnArchive').classList.add('active');
  renderList(arr, true);
}

// ‚îÄ‚îÄ TOGGLE ARCHIVE ‚îÄ‚îÄ
function toggleArchive() {
  showArchive = !showArchive;
  if (showArchive) renderArchive(); else render();
}

// ‚îÄ‚îÄ PIN ‚îÄ‚îÄ
function togglePin(id) {
  const d = load();
  const i = d.notes.findIndex(n => n.id === id);
  if (i >= 0) { d.notes[i].pinned = !d.notes[i].pinned; d.notes[i].updated = nowISO(); save(d); render(); }
}

// ‚îÄ‚îÄ CONFIRM DELETE ‚îÄ‚îÄ
let confirmCallback = null;
function askConfirm(msg, onYes) {
  document.getElementById('confirmMsg').textContent = msg;
  document.getElementById('confirmBackdrop').classList.add('open');
  confirmCallback = onYes;
}
function closeConfirm() {
  document.getElementById('confirmBackdrop').classList.remove('open');
  confirmCallback = null;
}

// ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ
function deleteNote(id) {
  const d = load();
  const i = d.notes.findIndex(n => n.id === id);
  if (i < 0) return;
  askConfirm('Pozn√°mka bude trvale odstranƒõna.', () => {
    const d2 = load();
    const i2 = d2.notes.findIndex(n => n.id === id);
    if (i2 < 0) return;
    d2.notes.splice(i2, 1);
    save(d2);
    if (showArchive) renderArchive(); else render();
    showToast('Smaz√°no ‚úì');
  });
}

// ‚îÄ‚îÄ ARCHIVE (done) ‚îÄ‚îÄ
function archiveNote(id) {
  const d = load();
  const i = d.notes.findIndex(n => n.id === id);
  if (i >= 0) {
    d.notes[i].archived = true;
    d.notes[i].updated  = nowISO();
    save(d); render();
    showToast('P≈ôesunuto do archivu ‚úì');
  }
}

// ‚îÄ‚îÄ RESTORE ‚îÄ‚îÄ
function restoreNote(id) {
  const d = load();
  const i = d.notes.findIndex(n => n.id === id);
  if (i >= 0) { d.notes[i].archived = false; d.notes[i].updated = nowISO(); save(d); renderArchive(); }
}

// ‚îÄ‚îÄ EDIT ‚îÄ‚îÄ
function openEdit(id) {
  const d = load();
  const n = d.notes.find(x => x.id === id);
  if (!n) return;
  editId = id;
  eCat   = n.category || 'other';
  document.getElementById('eTitle').value = n.title || '';
  document.getElementById('eBody').value  = n.text  || '';
  buildEGrid();
  document.getElementById('editPin').textContent = n.pinned ? 'Odepnout' : 'P≈ôipnout';
  document.getElementById('editArchiveBtn').textContent = n.archived ? 'Vr√°tit' : 'Archivovat';
  document.getElementById('editHeading').textContent = n.archived ? 'Archivovan√° pozn√°mka' : 'Upravit pozn√°mku';
  document.getElementById('editBackdrop').classList.add('open');
}
function closeEdit() {
  document.getElementById('editBackdrop').classList.remove('open');
  editId = null;
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function showToast(msg) {
  clearTimeout(toastTimer);
  document.getElementById('toastMsg').textContent = msg;
  document.getElementById('toast').classList.add('show');
  toastTimer = setTimeout(hideToast, 3000);
}
function hideToast() {
  clearTimeout(toastTimer);
  document.getElementById('toast').classList.remove('show');
}
// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', () => {
  buildQGrid();
  render();

  const qTitle = document.getElementById('qTitle');
  qTitle.addEventListener('input', validateAdd);
  qTitle.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); addNote(); }
  });
  document.getElementById('btnSend').onclick = addNote;
  document.getElementById('btnArchive').onclick = toggleArchive;

  document.getElementById('editSave').onclick = () => {
    if (!editId) return;
    const d = load();
    const i = d.notes.findIndex(n => n.id === editId);
    if (i < 0) return;
    const title = document.getElementById('eTitle').value.trim();
    if (!title) return;
    d.notes[i].title    = title;
    d.notes[i].text     = document.getElementById('eBody').value.trim();
    d.notes[i].category = eCat;
    d.notes[i].updated  = nowISO();
    save(d); closeEdit();
    if (showArchive) renderArchive(); else render();
  };
  document.getElementById('editPin').onclick = () => {
    if (!editId) return;
    const d = load();
    const i = d.notes.findIndex(n => n.id === editId);
    if (i >= 0) { d.notes[i].pinned = !d.notes[i].pinned; d.notes[i].updated = nowISO(); save(d); closeEdit(); render(); }
  };
  document.getElementById('editArchiveBtn').onclick = () => {
    if (!editId) return;
    const d = load();
    const i = d.notes.findIndex(n => n.id === editId);
    if (i < 0) return;
    d.notes[i].archived = !d.notes[i].archived;
    d.notes[i].updated  = nowISO();
    save(d); closeEdit();
    if (showArchive) renderArchive(); else render();
  };
  document.getElementById('editDelete').onclick = () => {
    if (!editId) return;
    const id = editId;
    closeEdit();
    deleteNote(id);
  };
  document.getElementById('confirmYes').onclick = () => {
    if (confirmCallback) confirmCallback();
    closeConfirm();
  };
  document.getElementById('confirmNo').onclick = closeConfirm;
  document.getElementById('confirmBackdrop').addEventListener('click', e => {
    if (e.target === document.getElementById('confirmBackdrop')) closeConfirm();
  });

  document.getElementById('editCancel').onclick = closeEdit;
  document.getElementById('editBackdrop').addEventListener('click', e => {
    if (e.target === document.getElementById('editBackdrop')) closeEdit();
  });
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeEdit();
  });
});
</script>
</body>
</html>
